(this["webpackJsonptruffle-react-redux-dapp"]=this["webpackJsonptruffle-react-redux-dapp"]||[]).push([[5],{822:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return i}));var n="0x0000000000000000000000000000000000000000",r=3,i=Math.pow(10,r)},823:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"h",(function(){return u})),a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return d})),a.d(t,"f",(function(){return m})),a.d(t,"g",(function(){return f})),a.d(t,"e",(function(){return b})),a.d(t,"a",(function(){return p})),a.d(t,"j",(function(){return v})),a.d(t,"k",(function(){return h})),a.d(t,"l",(function(){return g})),a.d(t,"i",(function(){return O}));var n=a(249),r=a(44),i=a.n(r),l=a(117),c=a.n(l).a.utils.BN,o="Bid",u="Reveal",s="Claim",d="Challenge",m="Finalize",f="Finalized",b="Expired",p=[o,u,s,d,m,f,b],v=function(e,t){return i.a.find(e,(function(e){return e.args[0]===t.args[0]}))},h=function(e,t){var a=i.a.get(e,"value",{}),n=a.bidEnd,r=a.revealEnd,l=a.claimEnd,c=a.challengeEnd,p=a.finalizeEnd,v=a.finalized;return t<i.a.toNumber(n)?o:t<i.a.toNumber(r)?u:t<i.a.toNumber(l)?s:t<i.a.toNumber(c)?d:t<i.a.toNumber(p)?m:v?f:b},g=function(e,t){var a,r=[],l=e.value.value;return t.sort(E),i.a.forEach(t,(function(e){var t=Object(n.a)(e.args,1)[0],i=e.value.value;if(l<0)return a=t,!1;l-=i,r.push(t)})),a||(a=i.a.last(r)),{winners:r,topLoser:a}},O=function(e,t){var a=new c(0);return i.a.forEach(e,(function(e){var r=Object(n.a)(e.args,1)[0],l=e.value,o=l.value,u=l.rate;i.a.includes(t,r)&&(a=a.add(new c(o).muln(100+parseInt(u)).divn(100)),console.log(u,a.toString()))})),a},E=function(e,t){var a=e.value,n=a.rate1,r=a.celerValue1,i=t.value,l=i.rate2,c=i.celerValue2;return n!==l?n-l:c-r}},881:function(e,t,a){"use strict";a.r(t);var n=a(39),r=a(72),i=a(73),l=a(75),c=a(74),o=a(76),u=a(0),s=a.n(u),d=a(1),m=a.n(d),f=a(44),b=a.n(f),p=a(118),v=a(880),h=a(877),g=a(69),O=a(882),E=a(113),j=a(57),k=a(820),A=a(241),y=a(884),B=a(834),C=a(878),w=a(883),V=a(821),S=a(879),z=a(245),P=[{title:"Bidder",dataIndex:"bidder"},{title:"Rate",dataIndex:"rate"},{title:"Value",dataIndex:"value"},{title:"Celer value",dataIndex:"celerValue"}],I=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,a=e.bids,r=e.network,i=Object(z.c)(r.supportedTokens,t.value.tokenAddress),l=b.a.filter(a).map((function(e){var t=e.args[0];return Object(n.a)({},e.value,{bidder:t,value:Object(z.b)(e.value.value,i),celerValue:Object(z.a)(e.value.celerValue)})}));return s.a.createElement(S.a,{dataSource:l,columns:P,pagination:!1})}}]),t}(s.a.Component);var L=Object(p.drizzleConnect)(I,(function(e){})),T=a(117),R=a.n(T),M=a(814),W=a(247),x=a(246),N=a(822),q=function(e){function t(e,a){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).onSubmit=function(){var e=n.props,t=e.auction,a=e.onClose;n.form.current.validateFields((function(e,r){if(!e){var i=r.celerValue,l=r.value,c=r.rate,o=r.passcode,u=t.args[0];n.contracts.LiBA.methods.placeBid.cacheSend(t.args[0],R.a.utils.soliditySha3(c*N.b,R.a.utils.toWei(l.toString(),"ether"),R.a.utils.toWei(i.toString(),"ether"),o),R.a.utils.toWei(i.toString(),"ether")),localStorage.setItem("auction".concat(u),JSON.stringify(r)),a()}}))},n.form=s.a.createRef(),n.contracts=a.drizzle.contracts,n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,a=e.network,r=e.visible,i=e.onClose,l=Object(z.c)(a.supportedTokens,t.value.tokenAddress),c=[{name:"value",field:"number",fieldOptions:Object(n.a)({},Object(x.c)(l),{placeholder:"The amount of token to lend"}),rules:[Object(x.e)(0),{message:"Please enter a value!",required:!0}]},{name:"rate",field:"number",fieldOptions:Object(n.a)({},x.f,{placeholder:"The lending interest rate",step:.1,precision:N.c}),rules:[Object(x.e)(0),{message:"Please enter a rate!",required:!0}]},{name:"celerValue",label:"CELR Value",field:"number",fieldOptions:Object(n.a)({},x.b,{placeholder:"The amount of celer token for bidding"}),rules:[Object(x.e)(0),{message:"Please enter a celer value!",required:!0}]},{name:"passcode",field:"number",fieldOptions:{placeholder:"A random number used to hide your bid info"},rules:[Object(x.e)(0),{message:"Please enter a passcode!",required:!0}]}];return s.a.createElement(M.a,{title:"Bid Auction",visible:r,onOk:this.onSubmit,onCancel:i},s.a.createElement(B.a,{type:"warning",message:"Once the bid is placed, you have to reveal it, or you will lose staked CELR",showIcon:!0}),s.a.createElement(W.a,{ref:this.form,items:c}))}}]),t}(s.a.Component);q.contextTypes={drizzle:m.a.object};var D=q,F=function(e){function t(e,a){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).onSubmit=function(){var e=n.props,t=e.auction,a=e.onClose;n.form.current.validateFields((function(e,r){if(!e){var i=r.celerValue,l=r.value,c=r.rate,o=r.passcode,u=r.commitmentID;n.contracts.LiBA.methods.revealBid.cacheSend(t.args[0],c*N.b,R.a.utils.toWei(l.toString(),"ether"),R.a.utils.toWei(i.toString(),"ether"),o,parseInt(u)),a()}}))},n.form=s.a.createRef(),n.contracts=a.drizzle.contracts,n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,a=e.network,r=e.PoLC,i=e.visible,l=e.onClose,c=Object(z.c)(a.supportedTokens,t.value.tokenAddress),o=b.a.map(r.commitmentsByUser,(function(e){var t=e.args[1],a=Object(z.b)(e.value.availableValue,c);return[t,"ID: ".concat(t,", Available Value: ").concat(a)]})),u=JSON.parse(localStorage.getItem("auction".concat(t.args[0]))||"{}"),d=[{name:"value",field:"number",initialValue:u.value,fieldOptions:Object(n.a)({},Object(x.c)(c),{placeholder:"The amount of token to lend"}),rules:[Object(x.e)(0),{message:"Please enter a value!",required:!0}]},{name:"rate",field:"number",initialValue:u.rate,fieldOptions:Object(n.a)({},x.f,{step:.1,precision:N.c,placeholder:"The lending interest rate"}),rules:[Object(x.e)(0),{message:"Please enter a rate!",required:!0}]},{name:"celerValue",label:"Celer Value",field:"number",initialValue:u.celerValue,fieldOptions:Object(n.a)({},x.b,{placeholder:"The amount of celer token for bidding"}),rules:[Object(x.e)(0),{message:"Please enter a celer value!",required:!0}]},{name:"passcode",field:"number",initialValue:u.passcode,fieldOptions:{placeholder:"The random number entered for bidding"},rules:[Object(x.e)(0),{message:"Please enter a passcode!",required:!0}]},{name:"commitmentID",field:"select",fieldOptions:{options:o,placeholder:"The commitment in PoLC used for lending"},rules:[{message:"Please enter a commitmentID!",required:!0}]}];return s.a.createElement(M.a,{title:"Reveal Auction",visible:i,onOk:this.onSubmit,onCancel:l},s.a.createElement(W.a,{ref:this.form,items:d}))}}]),t}(s.a.Component);F.contextTypes={drizzle:m.a.object};var J=Object(p.drizzleConnect)(F,(function(e){return{PoLC:e.contracts.PoLC}})),U=a(823),Y=v.a.Step,G=[U.b,U.h,U.d,U.c,U.f],H=function(e){function t(e,a){var n;Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).takeAction=function(){switch(n.state.currentPeriod){case U.b:return n.toggleBidModal();case U.h:return n.toggleRevealModal();case U.d:return n.claimWinners();case U.c:return n.challengeWinners();case U.f:return n.finalizeAuction()}},n.toggleBidModal=function(){n.setState((function(e){return{isBidModalVisible:!e.isBidModalVisible}}))},n.toggleRevealModal=function(){n.setState((function(e){return{isRevealModalVisible:!e.isRevealModalVisible}}))},n.claimWinners=function(){var e=n.state.auctionId,t=n.getWinners(),a=t.winners,r=t.topLoser;n.contracts.LiBA.methods.claimWinners(e,a,r).send()},n.challengeWinners=function(){var e=n.state,t=e.auctionId,a=e.winners,r=n.getWinners(),i=r.winners,l=r.topLoser;if(b.a.isEqual(a,i))h.a.error({message:"There is no need to challenge winners"});else{var c=b.a.difference(i,a)[0];n.contracts.LiBA.methods.challengeWinners(t,c,i,l).send()}},n.finalizeAuction=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.finalizeAuction.cacheSend(e)},n.finalizeBid=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.finalizeBid.cacheSend(e)},n.collectCollateral=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.collectCollateral.cacheSend(e)},n.repayAuction=function(){var e,t=n.state,a=t.auctionId,r=t.auction,i=t.bids,l=t.winners,c=[a];r.value.tokenAddress===N.a&&c.push({value:Object(U.i)(i,l).toString()}),(e=n.contracts.LiBA.methods.repayAuction).cacheSend.apply(e,c)},n.getWinners=function(){var e=n.state,t=e.auction,a=e.bids;return Object(U.l)(t,a)},n.renderAction=function(){var e=n.props.accounts,t=n.state,a=t.auction,r=t.currentPeriod,i=t.currentStep,l=t.winners,c=e[0];if(c===a.value.asker){if(r===U.g)return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.repayAuction},"Repay")];if(!b.a.includes([U.d,U.f],r))return[]}else{if(r===U.e||-1===i&&!b.a.includes(l,c))return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.finalizeBid},"Withdraw bid")];if(r===U.g)return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.collectCollateral},"Collect collateral")];if(!b.a.includes([U.b,U.h,U.c],r))return[]}return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.takeAction},r)]},n.renderAuctionDetail=function(){var e,t=n.props.network,a=n.state,r=a.auction,i=a.bids,l=a.winners,c=r.value,o=c.asker,u=c.tokenAddress,d=c.collateralAddress,m=c.collateralValue,f=c.value,p=c.duration,v=c.maxRate,h=c.minValue,g=Object(z.c)(t.supportedTokens,u),B=JSON.parse(localStorage.getItem("auction".concat(r.args[0]))||"{}");return e=b.a.isEmpty(B)?s.a.createElement(O.a,{status:"warning",title:"You have not placed bid yet"}):s.a.createElement(E.a,null,s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Value",value:B.value})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Rate",value:B.rate}))," ",s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Celer Value",value:B.celerValue}))," ",s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Passcode",value:B.passcode}))),s.a.createElement(E.a,{style:{marginTop:"10px"}},s.a.createElement(j.a,{span:24},s.a.createElement(k.a,{title:"Asker",value:o})),s.a.createElement(j.a,{span:24},s.a.createElement(k.a,{title:"Token Address",value:u})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Value",value:Object(z.b)(f,g)})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Duration",value:"".concat(p," Day")})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Min Value",value:Object(z.b)(h,g)})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Max Rate",value:"".concat(v/N.b," %")})),m>0&&s.a.createElement(s.a.Fragment,null,s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Collateral Address",value:d})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Collateral Value",value:m}))),s.a.createElement(j.a,{span:24},s.a.createElement(A.a,null,s.a.createElement(A.a.TabPane,{tab:"Your Bid",key:"own"},e),s.a.createElement(A.a.TabPane,{tab:"Bids",key:"bids"},s.a.createElement(L,{auction:r,bids:i,network:t})),s.a.createElement(A.a.TabPane,{tab:"Winners",key:"winners"},s.a.createElement(y.a,{size:"small",bordered:!0,dataSource:l,renderItem:function(e){return s.a.createElement(y.a.Item,null,e)}})))))},n.renderProgress=function(){var e=n.state,t=e.auctionPeriod,a=e.blockNumber,r=e.currentPeriod,i=e.currentStep;if(-1===i)return s.a.createElement(B.a,{type:"warning",message:r,showIcon:!0});var l=r.toLowerCase(),c=t.value[l+"End"]-a;return s.a.createElement(s.a.Fragment,null,s.a.createElement(v.a,{size:"small",current:i},b.a.map(G,(function(e){return s.a.createElement(Y,{key:e,title:e})}))),s.a.createElement(C.a,null,x.a.formatter(c)," left to ",l))},n.contracts=a.drizzle.contracts,n.state={auction:null,currentStep:0,currentPeriod:"",isBidModalVisible:!1,isRevealModalVisible:!1};var i=parseInt(e.match.params.id);return n.contracts.LiBA.events.RevealBid({fromBlock:0,filter:{auctionId:i}},(function(e,t){if(!e){var a=t.returnValues,r=a.auctionId,i=a.bidder;n.contracts.LiBA.methods.bidsByUser.cacheCall(i,r)}})),n.contracts.LiBA.events.ClaimWinners({fromBlock:0,filter:{auctionId:i}},(function(e,t){if(!e){var a=t.returnValues.winners;n.setState({winners:a})}})),n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.network,t=this.state,a=t.auction,n=(t.currentStep,t.currentPeriod,t.isBidModalVisible),r=t.isRevealModalVisible;return a?s.a.createElement(V.a,{title:"Auction",actions:this.renderAction()},this.renderProgress(),this.renderAuctionDetail(),s.a.createElement(D,{auction:a,network:e,visible:n,onClose:this.toggleBidModal}),s.a.createElement(J,{auction:a,network:e,visible:r,onClose:this.toggleRevealModal})):s.a.createElement(w.a,null)}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.match,a=e.LiBA,n=void 0===a?{}:a,r=e.network,i=b.a.values(n.getAuction),l=b.a.find(i,(function(e){return e.args[0]===t.params.id}));if(!l)return{};var c=Object(U.j)(n.getAuctionPeriod,l),o=b.a.get(r,"block.number"),u=Object(U.k)(c,o),s=b.a.indexOf(G,u),d=l.args[0],m=b.a.filter(n.bidsByUser,(function(e){return e.args[1]===d}));return{auction:l,auctionId:d,bids:m,auctionPeriod:c,blockNumber:o,currentPeriod:u,currentStep:s}}}]),t}(s.a.Component);H.contextTypes={drizzle:m.a.object};t.default=Object(p.drizzleConnect)(H,(function(e){var t=e.accounts,a=e.contracts,r=e.LiBA;return{accounts:t,network:e.network,LiBA:Object(n.a)({},r,{},a.LiBA)}}))}}]);
//# sourceMappingURL=5.2a20a5c0.chunk.js.map