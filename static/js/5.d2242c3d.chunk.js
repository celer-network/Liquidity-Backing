(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{795:function(e,t,a){"use strict";a.d(t,"c",function(){return l}),a.d(t,"b",function(){return o}),a.d(t,"a",function(){return u});var n=a(62),r=a.n(n),i=a(183),c=a.n(i),l=(a(145),function(e,t){var a=r.a.find(e,function(e){return e.address===t});return a?a.symbol:""}),o=function(e,t){return r.a.toNumber(e)<1e5?"".concat(e," wei"):"".concat(c.a.utils.fromWei(e)," ").concat(t)},u=function(e){return o(e,"CELR")}},796:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n="0x0000000000000000000000000000000000000000"},799:function(e,t,a){"use strict";a.d(t,"a",function(){return o}),a.d(t,"g",function(){return u}),a.d(t,"c",function(){return s}),a.d(t,"b",function(){return d}),a.d(t,"e",function(){return m}),a.d(t,"f",function(){return f}),a.d(t,"d",function(){return b}),a.d(t,"i",function(){return v}),a.d(t,"j",function(){return p}),a.d(t,"h",function(){return h});var n=a(238),r=a(62),i=a.n(r),c=a(183),l=a.n(c).a.utils.BN,o="Bid",u="Reveal",s="Claim",d="Challenge",m="Finalize",f="Finalized",b="Expired",v=function(e,t,a){var n=i.a.get(e,"block.number"),r=i.a.find(a,function(e){return e.args[0]===t.args[0]}),c=i.a.get(r,"value",{}),l=c.bidEnd,v=c.revealEnd,p=c.claimEnd,h=c.challengeEnd,g=c.finalizeEnd,O=c.finalized;return n<i.a.toNumber(l)?o:n<i.a.toNumber(v)?u:n<i.a.toNumber(p)?s:n<i.a.toNumber(h)?d:n<i.a.toNumber(g)?m:O?f:b},p=function(e,t){var a,r=[],c=e.value.value;return t.sort(g),i.a.forEach(t,function(e){var t=Object(n.a)(e.args,1)[0],i=e.value.value;if(c<0)return a=t,!1;c-=i,r.push(t)}),a||(a=i.a.last(r)),{winners:r,topLoser:a}},h=function(e,t){var a=new l(0);return i.a.forEach(e,function(e){var r=Object(n.a)(e.args,1)[0],c=e.value,o=c.value,u=c.rate;i.a.includes(t,r)&&(a=a.add(new l(o).muln(100+parseInt(u)).divn(100)),console.log(u,a.toString()))}),a},g=function(e,t){var a=e.value,n=a.rate1,r=a.celerValue1,i=t.value,c=i.rate2,l=i.celerValue2;return n!==c?n-c:l-r}},872:function(e,t,a){"use strict";a.r(t);var n=a(43),r=a(71),i=a(72),c=a(74),l=a(73),o=a(75),u=a(1),s=a.n(u),d=a(0),m=a.n(d),f=a(62),b=a.n(f),v=a(115),p=a(871),h=a(868),g=a(68),O=a(113),j=a(55),k=a(870),E=a(233),A=a(874),B=a(873),C=a(812),w=a(794),y=a(869),z=a(795),S=[{title:"Bidder",dataIndex:"bidder"},{title:"Rate",dataIndex:"rate"},{title:"Value",dataIndex:"value"},{title:"Celer value",dataIndex:"celerValue"}],V=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,a=e.bids,r=e.network,i=Object(z.c)(r.supportedTokens,t.value.tokenAddress),c=b.a.filter(a).map(function(e){var t=e.args[0];return Object(n.a)({},e.value,{bidder:t,value:Object(z.b)(e.value.value,i),celerValue:Object(z.a)(e.value.celerValue)})});return s.a.createElement(y.a,{dataSource:c,columns:S,pagination:!1})}}]),t}(s.a.Component);var I=Object(v.drizzleConnect)(V,function(e){}),L=a(183),P=a.n(L),T=a(784),W=a(236),R=a(235),M=function(e){function t(e,a){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).onSubmit=function(){var e=n.props,t=e.auction,a=e.onClose;n.form.current.validateFields(function(e,r){if(!e){var i=r.celerValue,c=r.value,l=r.rate,o=r.salt,u=1e3*l;n.contracts.LiBA.methods.placeBid.cacheSend(t.args[0],P.a.utils.soliditySha3(u,P.a.utils.toWei(c.toString(),"ether"),P.a.utils.toWei(i.toString(),"ether"),o),P.a.utils.toWei(i.toString(),"ether")),a()}})},n.form=s.a.createRef(),n.contracts=a.drizzle.contracts,n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,a=e.network,r=e.visible,i=e.onClose,c=Object(z.c)(a.supportedTokens,t.value.tokenAddress),l=[{name:"value",field:"number",fieldOptions:Object(n.a)({},Object(R.c)(c),{placeholder:"The amount of token to lend"}),rules:[Object(R.e)(0),{message:"Please enter a value!",required:!0}]},{name:"rate",field:"number",fieldOptions:Object(n.a)({},R.f,{placeholder:"The lending interest rate",step:.001,precision:3}),rules:[Object(R.e)(0),{message:"Please enter a rate!",required:!0}]},{name:"celerValue",label:"Celer Value",field:"number",fieldOptions:Object(n.a)({},R.b,{placeholder:"The amount of celer token for bidding"}),rules:[Object(R.e)(0),{message:"Please enter a celer value!",required:!0}]},{name:"salt",field:"number",fieldOptions:{placeholder:"A random number used to hide your bid info"},rules:[Object(R.e)(0),{message:"Please enter a salt!",required:!0}]}];return s.a.createElement(T.a,{title:"Bid Auction",visible:r,onOk:this.onSubmit,onCancel:i},s.a.createElement(W.a,{ref:this.form,items:l}))}}]),t}(s.a.Component);M.contextTypes={drizzle:m.a.object};var x=M,q=function(e){function t(e,a){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).onSubmit=function(){var e=n.props,t=e.auction,a=e.onClose;n.form.current.validateFields(function(e,r){if(!e){var i=r.celerValue,c=r.value,l=r.rate,o=r.salt,u=r.commitmentID,s=1e3*l;n.contracts.LiBA.methods.revealBid.cacheSend(t.args[0],s,P.a.utils.toWei(c.toString(),"ether"),P.a.utils.toWei(i.toString(),"ether"),o,parseInt(u)),a()}})},n.form=s.a.createRef(),n.contracts=a.drizzle.contracts,n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,a=e.network,r=e.PoLC,i=e.visible,c=e.onClose,l=Object(z.c)(a.supportedTokens,t.value.tokenAddress),o=b.a.map(r.commitmentsByUser,function(e){var t=e.args[1],a=Object(z.b)(e.value.availableValue,l);return[t,"ID: ".concat(t,", Available Value: ").concat(a)]}),u=[{name:"value",field:"number",fieldOptions:Object(n.a)({},Object(R.c)(l),{placeholder:"The amount of token to lend"}),rules:[Object(R.e)(0),{message:"Please enter a value!",required:!0}]},{name:"rate",field:"number",fieldOptions:Object(n.a)({},R.f,{step:.001,precision:3,placeholder:"The lending interest rate"}),rules:[Object(R.e)(0),{message:"Please enter a rate!",required:!0}]},{name:"celerValue",label:"Celer Value",field:"number",fieldOptions:Object(n.a)({},R.b,{placeholder:"The amount of celer token for bidding"}),rules:[Object(R.e)(0),{message:"Please enter a celer value!",required:!0}]},{name:"salt",field:"number",fieldOptions:{placeholder:"The random number entered for bidding"},rules:[Object(R.e)(0),{message:"Please enter a salt!",required:!0}]},{name:"commitmentID",field:"select",fieldOptions:{options:o,placeholder:"The commitment in PoLC used for lending"},rules:[{message:"Please enter a commitmentID!",required:!0}]}];return s.a.createElement(T.a,{title:"Reveal Auction",visible:i,onOk:this.onSubmit,onCancel:c},s.a.createElement(W.a,{ref:this.form,items:u}))}}]),t}(s.a.Component);q.contextTypes={drizzle:m.a.object};var D=Object(v.drizzleConnect)(q,function(e){return{PoLC:e.contracts.PoLC}}),N=a(799),F=a(796),U=p.a.Step,J=[N.a,N.g,N.c,N.b,N.e],G=function(e){function t(e,a){var n;Object(r.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).takeAction=function(){switch(n.state.currentPeriod){case N.a:return n.toggleBidModal();case N.g:return n.toggleRevealModal();case N.c:return n.claimWinners();case N.b:return n.challengeWinners();case N.e:return n.finalizeAuction()}},n.toggleBidModal=function(){n.setState(function(e){return{isBidModalVisible:!e.isBidModalVisible}})},n.toggleRevealModal=function(){n.setState(function(e){return{isRevealModalVisible:!e.isRevealModalVisible}})},n.claimWinners=function(){var e=n.state.auctionId,t=n.getWinners(),a=t.winners,r=t.topLoser;n.contracts.LiBA.methods.claimWinners(e,a,r).send()},n.challengeWinners=function(){var e=n.state,t=e.auctionId,a=e.winners,r=n.getWinners(),i=r.winners,c=r.topLoser;if(b.a.isEqual(a,i))h.a.error({message:"There is no need to challenge winners"});else{var l=b.a.difference(i,a)[0];n.contracts.LiBA.methods.challengeWinners(t,l,i,c).send()}},n.finalizeAuction=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.finalizeAuction.cacheSend(e)},n.finalizeBid=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.finalizeBid.cacheSend(e)},n.collectCollateral=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.collectCollateral.cacheSend(e)},n.repayAuction=function(){var e,t=n.state,a=t.auctionId,r=t.auction,i=t.bids,c=t.winners,l=[a];r.value.tokenAddress===F.a&&l.push({value:Object(N.h)(i,c).toString()}),(e=n.contracts.LiBA.methods.repayAuction).cacheSend.apply(e,l)},n.getWinners=function(){var e=n.state,t=e.auction,a=e.bids;return Object(N.j)(t,a)},n.renderAction=function(){var e=n.props.accounts,t=n.state,a=t.auction,r=t.currentPeriod,i=t.currentStep,c=t.winners,l=e[0];if(l===a.value.asker){if(r===N.f)return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.repayAuction},"Repay")];if(!b.a.includes([N.c,N.e],r))return[]}else{if(r===N.d||-1===i&&!b.a.includes(c,l))return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.finalizeBid},"Withdraw bid")];if(r===N.f)return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.collectCollateral},"Collect collateral")];if(!b.a.includes([N.a,N.g,N.b],r))return[]}return[s.a.createElement(g.a,{block:!0,type:"primary",onClick:n.takeAction},r)]},n.renderAuctionDetail=function(){var e=n.props.network,t=n.state,a=t.auction,r=t.bids,i=t.winners,c=a.value,l=c.asker,o=c.tokenAddress,u=c.collateralAddress,d=c.collateralValue,m=c.value,f=c.duration,b=c.maxRate,v=c.minValue,p=Object(z.c)(e.supportedTokens,o);return s.a.createElement(O.a,{style:{marginTop:"10px"}},s.a.createElement(j.a,{span:24},s.a.createElement(k.a,{title:"Asker",value:l})),s.a.createElement(j.a,{span:24},s.a.createElement(k.a,{title:"Token Address",value:o})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Value",value:Object(z.b)(m,p)})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Duration",value:"".concat(f," Day")})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Min Value",value:Object(z.b)(v,p)})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Max Rate",value:"".concat(b," %")})),d>0&&s.a.createElement(s.a.Fragment,null,"(",s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Collateral Address",value:u})),s.a.createElement(j.a,{span:12},s.a.createElement(k.a,{title:"Collateral Value",value:d}))),s.a.createElement(j.a,{span:24},s.a.createElement(E.a,null,s.a.createElement(E.a.TabPane,{tab:"Bids",key:"bids"},s.a.createElement(I,{auction:a,bids:r,network:e})),s.a.createElement(E.a.TabPane,{tab:"Winners",key:"winners"},s.a.createElement(A.a,{size:"small",bordered:!0,dataSource:i,renderItem:function(e){return s.a.createElement(A.a.Item,null,e)}})))))},n.contracts=a.drizzle.contracts,n.state={auction:null,currentStep:0,currentPeriod:"",isBidModalVisible:!1,isRevealModalVisible:!1};var i=parseInt(e.match.params.id);return n.contracts.LiBA.events.RevealBid({fromBlock:0,filter:{auctionId:i}},function(e,t){if(!e){var a=t.returnValues,r=a.auctionId,i=a.bidder;n.contracts.LiBA.methods.bidsByUser.cacheCall(i,r)}}),n.contracts.LiBA.events.ClaimWinners({fromBlock:0,filter:{auctionId:i}},function(e,t){if(!e){var a=t.returnValues.winners;n.setState({winners:a})}}),n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t=this.props.network,a=this.state,n=a.auction,r=a.currentStep,i=a.currentPeriod,c=a.isBidModalVisible,l=a.isRevealModalVisible;return n?(-1===r&&(e=s.a.createElement(C.a,{message:i,type:"info",showIcon:!0})),s.a.createElement(w.a,{title:"Auction",actions:this.renderAction()},e||s.a.createElement(p.a,{size:"small",current:r},b.a.map(J,function(e){return s.a.createElement(U,{key:e,title:e})})),this.renderAuctionDetail(),s.a.createElement(x,{auction:n,network:t,visible:c,onClose:this.toggleBidModal}),s.a.createElement(D,{auction:n,network:t,visible:l,onClose:this.toggleRevealModal}))):s.a.createElement(B.a,null)}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.match,a=e.LiBA,n=void 0===a?{}:a,r=e.network,i=b.a.values(n.getAuction),c=b.a.find(i,function(e){return e.args[0]===t.params.id});if(!c)return{};var l=Object(N.i)(r,c,n.getAuctionPeriod),o=b.a.indexOf(J,l),u=c.args[0],s=b.a.filter(n.bidsByUser,function(e){return e.args[1]===u});return{auction:c,auctionId:u,bids:s,currentStep:o,currentPeriod:l}}}]),t}(s.a.Component);G.contextTypes={drizzle:m.a.object};t.default=Object(v.drizzleConnect)(G,function(e){var t=e.accounts,a=e.contracts,r=e.LiBA;return{accounts:t,network:e.network,LiBA:Object(n.a)({},r,a.LiBA)}})}}]);
//# sourceMappingURL=5.d2242c3d.chunk.js.map