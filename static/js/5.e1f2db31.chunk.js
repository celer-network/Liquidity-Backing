(this["webpackJsonptruffle-react-redux-dapp"]=this["webpackJsonptruffle-react-redux-dapp"]||[]).push([[5],{826:function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return u}));var n=r(62),a=r.n(n),i=r(188),c=r.n(i),o=(r(146),function(e,t){var r=a.a.find(e,(function(e){return e.address===t}));return r?r.symbol:""}),l=function(e,t){return a.a.toNumber(e)<1e5?"".concat(e," wei"):"".concat(c.a.utils.fromWei(e)," ").concat(t)},u=function(e){return l(e,"CELR")}},827:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n="0x0000000000000000000000000000000000000000"},830:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"g",(function(){return u})),r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return d})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return b})),r.d(t,"d",(function(){return p})),r.d(t,"i",(function(){return m})),r.d(t,"j",(function(){return v})),r.d(t,"h",(function(){return O}));var n=r(249),a=r(62),i=r.n(a),c=r(188),o=r.n(c).a.utils.BN,l="Bid",u="Reveal",s="Claim",d="Challenge",f="Finalize",b="Finalized",p="Expired",m=function(e,t,r){var n=i.a.get(e,"block.number"),a=i.a.find(r,(function(e){return e.args[0]===t.args[0]})),c=i.a.get(a,"value",{}),o=c.bidEnd,m=c.revealEnd,v=c.claimEnd,O=c.challengeEnd,h=c.finalizeEnd,g=c.finalized;return n<i.a.toNumber(o)?l:n<i.a.toNumber(m)?u:n<i.a.toNumber(v)?s:n<i.a.toNumber(O)?d:n<i.a.toNumber(h)?f:g?b:p},v=function(e,t){var r,a=[],c=e.value.value;return t.sort(h),i.a.forEach(t,(function(e){var t=Object(n.a)(e.args,1)[0],i=e.value.value;if(c<0)return r=t,!1;c-=i,a.push(t)})),r||(r=i.a.last(a)),{winners:a,topLoser:r}},O=function(e,t){var r=new o(0);return i.a.forEach(e,(function(e){var a=Object(n.a)(e.args,1)[0],c=e.value,l=c.value,u=c.rate;i.a.includes(t,a)&&(r=r.add(new o(l).muln(100+parseInt(u)).divn(100)),console.log(u,r.toString()))})),r},h=function(e,t){var r=e.value,n=r.rate1,a=r.celerValue1,i=t.value,c=i.rate2,o=i.celerValue2;return n!==c?n-c:o-a}},903:function(e,t,r){"use strict";r.r(t);var n=r(46),a=r(71),i=r(72),c=r(74),o=r(73),l=r(75),u=r(0),s=r.n(u),d=r(1),f=r.n(d),b=r(62),p=r.n(b),m=r(114),v=r(900),O=r(898),h=r(79),g=r(111),j=r(55),y=r(901),E=r(243),k=r(904),w=r(902),P=r(843),A=r(825),B=r(899),C=r(826);function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var z=[{title:"Bidder",dataIndex:"bidder"},{title:"Rate",dataIndex:"rate"},{title:"Value",dataIndex:"value"},{title:"Celer value",dataIndex:"celerValue"}],V=function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,r=e.bids,a=e.network,i=Object(C.c)(a.supportedTokens,t.value.tokenAddress),c=p.a.filter(r).map((function(e){var t=e.args[0];return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(r,!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.value,{bidder:t,value:Object(C.b)(e.value.value,i),celerValue:Object(C.a)(e.value.celerValue)})}));return s.a.createElement(B.a,{dataSource:c,columns:z,pagination:!1})}}]),t}(s.a.Component);var D=Object(m.drizzleConnect)(V,(function(e){})),I=r(188),L=r.n(I),T=r(815),W=r(247),R=r(246);function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(r,!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q=function(e){function t(e,r){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).onSubmit=function(){var e=n.props,t=e.auction,r=e.onClose;n.form.current.validateFields((function(e,a){if(!e){var i=a.celerValue,c=a.value,o=a.rate,l=a.salt,u=1e3*o;n.contracts.LiBA.methods.placeBid.cacheSend(t.args[0],L.a.utils.soliditySha3(u,L.a.utils.toWei(c.toString(),"ether"),L.a.utils.toWei(i.toString(),"ether"),l),L.a.utils.toWei(i.toString(),"ether")),r()}}))},n.form=s.a.createRef(),n.contracts=r.drizzle.contracts,n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,r=e.network,n=e.visible,a=e.onClose,i=Object(C.c)(r.supportedTokens,t.value.tokenAddress),c=[{name:"value",field:"number",fieldOptions:x({},Object(R.c)(i),{placeholder:"The amount of token to lend"}),rules:[Object(R.e)(0),{message:"Please enter a value!",required:!0}]},{name:"rate",field:"number",fieldOptions:x({},R.f,{placeholder:"The lending interest rate",step:.001,precision:3}),rules:[Object(R.e)(0),{message:"Please enter a rate!",required:!0}]},{name:"celerValue",label:"Celer Value",field:"number",fieldOptions:x({},R.b,{placeholder:"The amount of celer token for bidding"}),rules:[Object(R.e)(0),{message:"Please enter a celer value!",required:!0}]},{name:"salt",field:"number",fieldOptions:{placeholder:"A random number used to hide your bid info"},rules:[Object(R.e)(0),{message:"Please enter a salt!",required:!0}]}];return s.a.createElement(T.a,{title:"Bid Auction",visible:n,onOk:this.onSubmit,onCancel:a},s.a.createElement(W.a,{ref:this.form,items:c}))}}]),t}(s.a.Component);q.contextTypes={drizzle:f.a.object};var N=q;function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(r,!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var J=function(e){function t(e,r){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).onSubmit=function(){var e=n.props,t=e.auction,r=e.onClose;n.form.current.validateFields((function(e,a){if(!e){var i=a.celerValue,c=a.value,o=a.rate,l=a.salt,u=a.commitmentID,s=1e3*o;n.contracts.LiBA.methods.revealBid.cacheSend(t.args[0],s,L.a.utils.toWei(c.toString(),"ether"),L.a.utils.toWei(i.toString(),"ether"),l,parseInt(u)),r()}}))},n.form=s.a.createRef(),n.contracts=r.drizzle.contracts,n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.auction,r=e.network,n=e.PoLC,a=e.visible,i=e.onClose,c=Object(C.c)(r.supportedTokens,t.value.tokenAddress),o=p.a.map(n.commitmentsByUser,(function(e){var t=e.args[1],r=Object(C.b)(e.value.availableValue,c);return[t,"ID: ".concat(t,", Available Value: ").concat(r)]})),l=[{name:"value",field:"number",fieldOptions:U({},Object(R.c)(c),{placeholder:"The amount of token to lend"}),rules:[Object(R.e)(0),{message:"Please enter a value!",required:!0}]},{name:"rate",field:"number",fieldOptions:U({},R.f,{step:.001,precision:3,placeholder:"The lending interest rate"}),rules:[Object(R.e)(0),{message:"Please enter a rate!",required:!0}]},{name:"celerValue",label:"Celer Value",field:"number",fieldOptions:U({},R.b,{placeholder:"The amount of celer token for bidding"}),rules:[Object(R.e)(0),{message:"Please enter a celer value!",required:!0}]},{name:"salt",field:"number",fieldOptions:{placeholder:"The random number entered for bidding"},rules:[Object(R.e)(0),{message:"Please enter a salt!",required:!0}]},{name:"commitmentID",field:"select",fieldOptions:{options:o,placeholder:"The commitment in PoLC used for lending"},rules:[{message:"Please enter a commitmentID!",required:!0}]}];return s.a.createElement(T.a,{title:"Reveal Auction",visible:a,onOk:this.onSubmit,onCancel:i},s.a.createElement(W.a,{ref:this.form,items:l}))}}]),t}(s.a.Component);J.contextTypes={drizzle:f.a.object};var G=Object(m.drizzleConnect)(J,(function(e){return{PoLC:e.contracts.PoLC}})),H=r(830),K=r(827);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(r,!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y=v.a.Step,Z=[H.a,H.g,H.c,H.b,H.e],$=function(e){function t(e,r){var n;Object(a.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).takeAction=function(){switch(n.state.currentPeriod){case H.a:return n.toggleBidModal();case H.g:return n.toggleRevealModal();case H.c:return n.claimWinners();case H.b:return n.challengeWinners();case H.e:return n.finalizeAuction()}},n.toggleBidModal=function(){n.setState((function(e){return{isBidModalVisible:!e.isBidModalVisible}}))},n.toggleRevealModal=function(){n.setState((function(e){return{isRevealModalVisible:!e.isRevealModalVisible}}))},n.claimWinners=function(){var e=n.state.auctionId,t=n.getWinners(),r=t.winners,a=t.topLoser;n.contracts.LiBA.methods.claimWinners(e,r,a).send()},n.challengeWinners=function(){var e=n.state,t=e.auctionId,r=e.winners,a=n.getWinners(),i=a.winners,c=a.topLoser;if(p.a.isEqual(r,i))O.a.error({message:"There is no need to challenge winners"});else{var o=p.a.difference(i,r)[0];n.contracts.LiBA.methods.challengeWinners(t,o,i,c).send()}},n.finalizeAuction=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.finalizeAuction.cacheSend(e)},n.finalizeBid=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.finalizeBid.cacheSend(e)},n.collectCollateral=function(){var e=n.state.auctionId;n.contracts.LiBA.methods.collectCollateral.cacheSend(e)},n.repayAuction=function(){var e,t=n.state,r=t.auctionId,a=t.auction,i=t.bids,c=t.winners,o=[r];a.value.tokenAddress===K.a&&o.push({value:Object(H.h)(i,c).toString()}),(e=n.contracts.LiBA.methods.repayAuction).cacheSend.apply(e,o)},n.getWinners=function(){var e=n.state,t=e.auction,r=e.bids;return Object(H.j)(t,r)},n.renderAction=function(){var e=n.props.accounts,t=n.state,r=t.auction,a=t.currentPeriod,i=t.currentStep,c=t.winners,o=e[0];if(o===r.value.asker){if(a===H.f)return[s.a.createElement(h.a,{block:!0,type:"primary",onClick:n.repayAuction},"Repay")];if(!p.a.includes([H.c,H.e],a))return[]}else{if(a===H.d||-1===i&&!p.a.includes(c,o))return[s.a.createElement(h.a,{block:!0,type:"primary",onClick:n.finalizeBid},"Withdraw bid")];if(a===H.f)return[s.a.createElement(h.a,{block:!0,type:"primary",onClick:n.collectCollateral},"Collect collateral")];if(!p.a.includes([H.a,H.g,H.b],a))return[]}return[s.a.createElement(h.a,{block:!0,type:"primary",onClick:n.takeAction},a)]},n.renderAuctionDetail=function(){var e=n.props.network,t=n.state,r=t.auction,a=t.bids,i=t.winners,c=r.value,o=c.asker,l=c.tokenAddress,u=c.collateralAddress,d=c.collateralValue,f=c.value,b=c.duration,p=c.maxRate,m=c.minValue,v=Object(C.c)(e.supportedTokens,l);return s.a.createElement(g.a,{style:{marginTop:"10px"}},s.a.createElement(j.a,{span:24},s.a.createElement(y.a,{title:"Asker",value:o})),s.a.createElement(j.a,{span:24},s.a.createElement(y.a,{title:"Token Address",value:l})),s.a.createElement(j.a,{span:12},s.a.createElement(y.a,{title:"Value",value:Object(C.b)(f,v)})),s.a.createElement(j.a,{span:12},s.a.createElement(y.a,{title:"Duration",value:"".concat(b," Day")})),s.a.createElement(j.a,{span:12},s.a.createElement(y.a,{title:"Min Value",value:Object(C.b)(m,v)})),s.a.createElement(j.a,{span:12},s.a.createElement(y.a,{title:"Max Rate",value:"".concat(p," %")})),d>0&&s.a.createElement(s.a.Fragment,null,"(",s.a.createElement(j.a,{span:12},s.a.createElement(y.a,{title:"Collateral Address",value:u})),s.a.createElement(j.a,{span:12},s.a.createElement(y.a,{title:"Collateral Value",value:d}))),s.a.createElement(j.a,{span:24},s.a.createElement(E.a,null,s.a.createElement(E.a.TabPane,{tab:"Bids",key:"bids"},s.a.createElement(D,{auction:r,bids:a,network:e})),s.a.createElement(E.a.TabPane,{tab:"Winners",key:"winners"},s.a.createElement(k.a,{size:"small",bordered:!0,dataSource:i,renderItem:function(e){return s.a.createElement(k.a.Item,null,e)}})))))},n.contracts=r.drizzle.contracts,n.state={auction:null,currentStep:0,currentPeriod:"",isBidModalVisible:!1,isRevealModalVisible:!1};var i=parseInt(e.match.params.id);return n.contracts.LiBA.events.RevealBid({fromBlock:0,filter:{auctionId:i}},(function(e,t){if(!e){var r=t.returnValues,a=r.auctionId,i=r.bidder;n.contracts.LiBA.methods.bidsByUser.cacheCall(i,a)}})),n.contracts.LiBA.events.ClaimWinners({fromBlock:0,filter:{auctionId:i}},(function(e,t){if(!e){var r=t.returnValues.winners;n.setState({winners:r})}})),n}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t=this.props.network,r=this.state,n=r.auction,a=r.currentStep,i=r.currentPeriod,c=r.isBidModalVisible,o=r.isRevealModalVisible;return n?(-1===a&&(e=s.a.createElement(P.a,{message:i,type:"info",showIcon:!0})),s.a.createElement(A.a,{title:"Auction",actions:this.renderAction()},e||s.a.createElement(v.a,{size:"small",current:a},p.a.map(Z,(function(e){return s.a.createElement(Y,{key:e,title:e})}))),this.renderAuctionDetail(),s.a.createElement(N,{auction:n,network:t,visible:c,onClose:this.toggleBidModal}),s.a.createElement(G,{auction:n,network:t,visible:o,onClose:this.toggleRevealModal}))):s.a.createElement(w.a,null)}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.match,r=e.LiBA,n=void 0===r?{}:r,a=e.network,i=p.a.values(n.getAuction),c=p.a.find(i,(function(e){return e.args[0]===t.params.id}));if(!c)return{};var o=Object(H.i)(a,c,n.getAuctionPeriod),l=p.a.indexOf(Z,o),u=c.args[0],s=p.a.filter(n.bidsByUser,(function(e){return e.args[1]===u}));return{auction:c,auctionId:u,bids:s,currentStep:l,currentPeriod:o}}}]),t}(s.a.Component);$.contextTypes={drizzle:f.a.object};t.default=Object(m.drizzleConnect)($,(function(e){var t=e.accounts,r=e.contracts,n=e.LiBA;return{accounts:t,network:e.network,LiBA:X({},n,{},r.LiBA)}}))}}]);
//# sourceMappingURL=5.e1f2db31.chunk.js.map